\documentclass{article}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[czech]{babel}
\usepackage{graphicx}
\usepackage{listings}
\graphicspath{{Images/}}
\usepackage{color}
\usepackage{caption}
\usepackage{fancyhdr}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, calc}


\usepackage[backend=biber,style=alphabetic]{biblatex}
\addbibresource{references.bib}

% Nastavení zahlaví
\pagestyle{fancy}
\fancyhf{}
\lhead{Gymnázium Arabská 14, Praha 6}
\rhead{\small\textbf{Rheed}}
\fancyfoot[C]{\thepage}


\lstset{language=java}
\lstset{literate= {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1 {ý}{{\'y}}1 {č}{{\v{c}}}1 {ď}{{\v{d}}}1 {ě}{{\v{e}}}1 {ň}{{\v{n}}}1 {ř}{{\v{r}}}1 {š}{{\v{s}}}1 {ť}{{\v{t}}}1 {ů}{{\r{u}}}1 {ž}{{\v{z}}}1 {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1 {Ý}{{\'Y}}1 {Č}{{\v{C}}}1 {Ď}{{\v{D}}}1 {Ě}{{\v{E}}}1 {Ň}{{\v{N}}}1 {Ř}{{\v{R}}}1 {Š}{{\v{S}}}1 {Ť}{{\v{T}}}1 {Ů}{{\r{U}}}1 {Ž}{{\v{Z}}}1}


\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

    \lstset{style=mystyle}

\begin{document}
\thispagestyle{empty}  % Pouze na první stránce bez číslování
\begin{figure}[htp]
    \centering
    \includegraphics[width=0.2\textwidth]{images/logo.png}
    \label{fig:logo_skoly}
\end{figure}

\centerline{\scshape\Huge Gymnázium, Praha 6, Arabská 14\par}
\vspace{1cm}
\centerline{\scshape\Large předmět programování, vyučující Daniel Kahoun\par}
\vspace{2cm}
\centerline{\huge\bfseries Rheed\par}
\vspace{0.5cm}
\centerline{\normalsize\bfseries Ročníkový projekt}

\vspace{2cm}
{\Large\ \\Marek Bílý,\\ Jan Schreiber,\\ Marek Švec\\ 3.E\hfill březen 2025}

\newpage
\pagenumbering{arabic}
\pagestyle{fancy}

\section*{Prohlášení}
\addcontentsline{toc}{section}{Prohlášení}
	Prohlašujeme, že jsme jedinými autory tohoto projektu, všechny citace jsou
	řádně označené a všechna použitá literatura a další zdroje jsou v práci uvedeny.
	
	Tímto dle zákona 121/2000 Sb. (tzv. Autorský zákon) ve znění pozdějších předpisů udělujeme
	bezúplatně škole Gymnázium, Praha 6, Arabská 14 oprávnění k výkonu práva na rozmnožování díla
	(§ 13) a práva na sdělování díla veřejnosti (§ 18) na dobu časově neomezenou a bez omezení
	územního rozsahu.

	\vspace{1cm}
	
	{Podpis autora: }
	\makebox[4cm]{\hrulefill} \hspace{3cm}
	Datum: \makebox[3cm]{\hrulefill}

\newpage

\tableofcontents

\newpage

\section*{Anotace}

\subsection*{Název práce: Rheed}
autoři: Marek Bílý, Jan Schreiber, Marek Švec
\vspace{0.5cm}

\subsection*{Title: Rheed}
authors: Marek Bílý, Jan Schreiber, Marek Švec
\vspace{0.5cm}

\subsection*{Titel: Rheed}
autoren: Marek Bílý, Jan Schreiber, Marek Švec
\vspace{0.5cm}
\newpage
\section{Úvod}
    RHEED (Reflection High-Energy Electron Diffraction) je metoda povrchové analýzy krystalických materiálů. Je zde využíván vysokoenergetický elektronový paprsek, který pod velmi malým úhlem dopadá na krystalickou strukturu zkoumaného materiálu. Elektrony se následně odrážejí od atomů na povrchu a vytvářejí tzv. difrakční vzor. Ten obsahuje potřebné informace o vzorku.\\

    RHEED se skládá ze tří hlavních komponent: zdroje elektronového paprsku, vzorku a detekčního systému. Zdroj elektronového paprsku, někdy nazývaný elektronový kanón, je zodpovědný za generování vysokoenergetického svazku přesně zamířeného na povrch krystalového vzorku. Vzorek je umístěn v ultravysokém vakuu tak, aby s ním bylo možné nadálku manipulovat a otáčet pro získávání informací z více stran. Detekční systém má za úkol zachycovat difrakční vzor vzniklý rozptýlením elektronů po střetu s atomy vzorku. Nejběžnějšími nástroji zde slouží fluorescenční obrazovka, na kterou dopadají zmíněné elektrony, a CCP (charge-coupled device) kamera, která obraz zaznamenává. K analýze sebraných dat nakonec slouží softwarový program, jehož vytvoření je cílem naší práce.
    
\subsection{Zadání práce}
    Aplikace bude sloužit jako lepší alternativa stávající, z části nefunkční, aplikace v C\#. Vývoj bude obsahovat jak hardware interfacing s CCD detektorem, návrh a realizaci GUI, práci s obrazovými daty (integrace snímků), vizualizaci real-time a analýzu real-time obrazových dat, ukládání starších měřených dat do databáze pro další výzkum atd. Aplikace bude implementovat in-situ měřící metodu RHEED (Reflection High-Energy Electron Diffraction) využívající difrakci vysokoenergetických elektronů při odrazu od povrchu. Zpracování dat z této metody bude sloužit k charakterizaci celého procesu a spolehlivější predikci výsledku růstu ještě před jeho dokončením. Výsledný program bude využit na vědeckých pracovištích Fyzikálního ústavu AV ČR a to na oddělení spintroniky a kvantových materiálů Dr. Jungwirtha a ve výzkumné skupině Dr. Tima Verhagena zabývající se přípravou sandwichových materiálů s feroelektrickými vlastnostmi.
\newpage
\subsection{Použité technologie}

Pro realizaci projektu byly využity následující knihovny:

\begin{itemize}
    \item \textbf{h5py (3.13.0)} – Knihovna pro práci se soubory ve formátu HDF5, využívaná pro ukládání a organizaci obrazových dat.
    \item \textbf{lxml (5.3.1)} – Zpracování XML a HTML souborů.
    \item \textbf{matplotlib (3.10.0)} – Vizualizace dat v Pythonu.
    \item \textbf{numpy (2.2.3)} – Vědecké výpočty a efektivní práce s poli.
    \item \textbf{opencv (4.11.0.86)} – Zpracování obrazu a práci s kamerou.
    \item \textbf{pillow (11.1.0)} – Manipulace s obrazovými soubory různých formátů.
    \item \textbf{OpenGL} – Rozhraní pro 2D a 3D grafiku.
    \item \textbf{PyQt5 (5.15.11)} – Tvorbu GUI na bázi Qt.
    \item \textbf{dateutil (2.9.0)} – Rozšíření práce s datem a časem.
    \item \textbf{silx (2.2.0 a 1.17.0)} – Vědecké vizualizace a práce s daty.
\end{itemize}

Kromě těchto knihoven byly využity další nástroje pro vývoj softwaru, zejména:

\begin{itemize}
    \item \textbf{Python 3.10+} – Hlavní programovací jazyk projektu.
    \item \textbf{Visual Studio Code} – Vývojové prostředí používané pro programování a ladění kódu.
    \item \textbf{HDF5 formát} – Efektivní způsob ukládání a správy velkých datových souborů.
    \item \textbf{Player One Saturn-C} – Kamera použitá pro sběr difrakčních snímků.
\end{itemize}



\subsection{Cíl práce}
    Cílem naší ročníkové práce je vytvořit software pro analýzu a vizualizaci obrazových dat z in-situ  měření RHEED během růstu monoatomárních vrstev pomocí technologie MBE. Tato aplikace má být schopná pracovat jak s obrázky nebo videy, tak i s živým přenosem. Aplikace má za cíl být co nejpraktičtějším nástrojem profesionálů pracujících s technologií RHEED.

\section{Teorie??}

\section{Aplikace Rheed a její struktura}
    
\subsection{Kamera}
Pro snímání difrakčních vzorků jsme využili kameru \textbf{Player One Saturn-C}. Kamera disponuje CMOS snímačem s rozlišením 3856 x 2180 pixelů a velikostí pixelu 3.45 µm. To jí umožňuje detekovat i velmi malé detaily, nezbytný předpoklad při analýze difrakčních struktur.
    Dále má široký dynamický rozsah, tudíž není problém jak s intenzivními, tak slabými světelnými signály. Zároveň se zde nachází i optimalizovaná citlivost ve viditelném i blízkém infračerveném světle.
    Vysokorychlostní přenos dat zajišťuje rozhraní USB 3.0. To je důležité zejména pro sledování vzorku v reálném čase, znamená to žádné prodlevy a tudíž menší riziko zkažení vzorku.
    Výstup se zde nachází dvanáctibitový, tedy každý pixel je schopný zaznamenat až 4096 odstínů intenzity světla. Naprosto klíčový předpoklad v prostředí, kde i minimální rozdíl v intenzitě může nést důležité informace o struktuře vzorku.

\subsubsection{Ovladač kamery}
S kamerou operuje soubor "opencv\_capture.py", který kameru inicializuje, konfiguruje a stará se o záznam snímků. Při spuštění je kamera inicializována a nastavena na požadované parametry a dále je zajištěno propojení s kamerou pomocí knihovny OpenCV. Při zdařilé inicializaci se otevírá datové úložiště, kde se každá relace ukládá do unikátního souboru ve složce cacheimg. To je adresář pro ukládání dat.\\

Při ukončení záznamu je modul vybaven funkcemi zajišťujícími, že nedochází k úniku paměti nebo blokování systémových prostředků. Uzavírá se jak kamerové rozhraní tak soubory, čímž se předchází nechtěnému růstu souborů nebo vzniku chyb v již nasbíraných datech. Zároveň je vše uvedeno do stavu, kdy nic nebrání další bezproblémové inicializaci kamery.


\subsubsection{Ukládání, HDF5 formát a analýza snímků}
Ukládání a následná analýza difrakčních snímků jsou důležitými aspekty při zpracování dat. Pro efektivní správu a organizaci velkého množství získaných obrazových dat využíváme formát HDF5 (Hierarchical Data Format version 5), který umožňuje strukturované ukládání dat s možností rozšiřování a optimalizace výkonu při čtení a zápisu. Veškeré snímky pořízené kamerou Player One Saturn-C jsou ukládány v binárním formátu s vysokou přesností, umožňující jejich následnou analýzu a vizualizaci v interaktivním prostředí aplikace.\\

HDF5 formát je tedy skvělou volbou pro organizaci a manipulaci s velkými objemy dat. HDF5 je hiearchycký souborový formát a umožňuje schraňování různých datových struktur v jednom souboru. V naší aplikaci je využíván pouze pro ukládání a organizaci snímků difrakčních vzorků, ale formát jako takový se dá využít i pro ukládání numerických simulacích nebo jiných měření. Dá se říci že je to systém menších souborů uvnitř jednoho většího binárního souboru. Organizování uvnitř formátu HDF5 jinak funguje velmi obdobně jako v běžném souborovém systému. Má tři hlavní složky: Skupiny, Datasety a Atributy. My pro ukládání snímků využíváme datasety, kde je každý snímek uložen jako matice hodnot intenzit.

Při inicializaci kamery se vytvoří nový soubor ve formátu HDF5, který slouží jako sklad pro všechny snímky pořízené v rámci jedné relace. Každý soubor je uložen v již zmíněné složce cacheimg, přičemž jeho název je generován dynamicky podle aktuálního data a času, aby bylo možné snímky jednoznačně identifikovat. Vytvořený dataset arrays je předalokován s definovanou počáteční kapacitou, čímž se minimalizuje latence při zápisu nových snímků. Díky funkci rozšiřitelnosti datasetu je také možné dynamicky alokovat další paměť v případě, že počet uložených snímků překročí původní alokaci. Tento proces probíhá automaticky a při dosažení limitu se dataset rozšíří o 1000 snímků.\\

Každý snímek je před uložením převáděn do stupňů šedi a volitelně může být normalizován s vysokou přesností pomocí 64bitových hodnot. Tento přístup je klíčový pro zachování detailů v intenzitě difrakčních vzorků, které by mohly být při běžném 8bitovém nebo 16bitovém ukládání ztraceny. Uložené snímky lze následně číst a zpracovávat v rámci dalších analýz, aniž by došlo ke snížení kvality záznamu. Vizualizace snímků probíhá v interaktivním grafickém prostředí s možností výběru konkrétních oblastí zájmu, více v kapitole "ROI a jejich správa". Pro zajištění plynulé vizualizace a analýzy je veškeré zpracování snímků realizováno v samostatném vláknu, které neblokuje hlavní běh aplikace. Díky tomu je možné sledovat změny v datech bez jakýchkoliv prodlev. Celý proces podporuje automatickou aktualizaci, přičemž uživatel může volit mezi manuálním a automatickým režimem, který průběžně zpracovává nové snímky.\\

Tento systém umožňuje nejen efektivní ukládání velkého objemu obrazových dat, ale také jejich pokročilou analýzu s využitím interaktivních nástrojů. Kombinace rychlého ukládání, dynamického rozšiřování datasetu a real-time vizualizace poskytuje uživateli výkonný nástroj pro studium difrakčních vzorků s vysokou přesností a flexibilitou.\\


\subsubsection{Zpracování obrazu}
V rámci vývoje softwaru pro analýzu RHEED snímků bylo nutné zajistit efektivní zpracování obrazu v reálném čase a jeho vizualizaci. K tomu je využita kombinace OpenCV pro získávání a předzpracování snímků a knihovny Silx pro jejich vykreslování. Důležitým prvkem je implementace Silx Plot2D s využitím OpenGL akcelerace, která umožňuje práci s obrazovými daty i při vysokém objemu snímků. To umožňuje uživateli provádět analýzu snímků bez výrazné latence.\\

Proces začíná snímáním obrazu pomocí kamery, přičemž data jsou získávána přes OpenCV a jak bylo zmíněno výše, jsou ihned převedena do odstínů šedi. Převod do monochromatické formy snižuje datovou náročnost a zjednodušuje další zpracování, především při analýze intenzity difrakčních vzorů. V této fázi může být prováděna také normalizace obrazu, což umožňuje optimalizaci kontrastu snímků. Po získání a úpravě obrazu je snímek odeslán do Silx Plot2D, který slouží jako vizualizační nástroj pro zobrazení jednotlivých snímků a dat. Zásadní výhodou tohoto řešení je využití OpenGL backendu, což umožňuje hardwarově akcelerované vykreslování. OpenGL významně snižuje nároky na procesor a umožňuje manipulaci se snímky i při vysokém objemu dat.\\

Pro plynulé zobrazení snímků je implementována vláknová správa aktualizace obrazu, která umožňuje přenos dat mezi OpenCV a Silx Plot2D. Tento přístup zajišťuje, že nově získané snímky jsou ihned přidány do vykreslovacího okna bez nutnosti pozastavení běhu aplikace. Snímky jsou přidávány pomocí asynchronních volání, aby GUI aplikace zůstalo responzivní i při dlouhodobém záznamu. Tím je zajištěno, že všechny vykreslovací operace jsou prováděny na GPU, čímž se významně snižuje zatížení CPU a umožňuje práci i při zobrazení několika snímků najednou. Díky tomu je možné nejen zobrazovat jednotlivé snímky, ale i provádět časovou analýzu sekvenčních dat, což je klíčové pro sledování dynamických změn v difrakčních vzorech.\\

\subsection{GUI aplikace}
GUI pro aplikaci RHEED je navrženo tak, aby poskytovalo uživatelsky přívětivé a intuitivní rozhraní pro vizualizaci obrazových dat a následnou analýzu. V GUI se může pracovat s kamerou, nastavením živého přenosu, vytvářením a úpravou ROI (region of interest) a analýzou dat. GUI je postaveno pomocí knihovny Silx což je nástavba na QTPY5

\subsubsection{Okno vizualizace}
Významným prvkem interaktivního uživatelského prostředí je okno vizualizace, které slouží k přehlednému zobrazení snímků a videa RHEED a jejich analýze. Tento modul zařizuje jak zobrazování snímků, správu ROI tak výpočty parametrů. Okno vizualizace je vytvořené s knihovnou Silx, která poskytuje užitečné nástroje pro zpracovávání a zobrazování dat.\\

Okno vizualizace se skládá z několika komponent: hlavní zobrazovací plocha, ROI manager, statistický panel, panel režimu aktualizace a Toolbar (nástrojová lišta). Hlavní zobrazovací plocha zobrazuje aktuální snímek. Statistický panel vypočítává a zobrazuje parametry intenzity signálu pro vybrané ROI. Panel režimu aktualizace ovládá způsoby statistických výpočtů. Tyto dva panely spolu úzce souvisí a dodatečné informace k nim, ROI manageru a Toolbaru představíme v následujících podkapitolách. 

\subsubsection{Statistický panel}
Statistická panel slouží k analýze dat v rámci jednotlivých ROI. Implementován je s pomocí ROIStatsWidget, který propojuje ROI manager s výpočetními funkcemi a poskytuje přehled statistik vypočítaných pro jednotlivé ROI. Mezi dostupné statistiky naší aplikace patří například průměrná intenzita signálu.

\subsubsection{Panel režimu aktualizace}
Panel režimu aktualizace slouží k ovládání způsobu, jakým se aktualizují statistické výpočty. Uživateli je v něm umožněno přepínat mezi dvěma režimy aktualizace. V automatickém režimu jsou statistiky přepočítávány průběžně bez zásahu uživatele, zatímco v manuálním režimu se aktualizace provede pouze po stisknutí tlačítka "update".

\subsubsection{Toolbar}
Toolbar obsahuje sadu tlačítek pro jednoduchou interakci s vizualizací obrazu a jeho přizpůsobením dle potřeb uživatele. Toolbar se nachází v horní části aplikace a poskytuje rychlý přístup k nástrojům pro navigaci, úpravu vzhledu a analýzu dat.\\

Pro manipulaci s obrazem lze využít tlačítkem lupy pro přiblížení vybrané oblasti, posuvník k pohybu po snímku bez změny měřítka. Všechny omyly v úpravě obrazu lze rychle napravit tlačítkem "reset pozic". Tlačítko "aspect ratio" umožňuje uživatelovi vybrat si mezi poměrem stran obrazu (možnost "keep aspect  ratio") a poměrem stran videa potažmo snímku (možnost "do not keep aspect ratio"). V Toolbaru se nachází nástroj pro změnu orientace osy Y. Uživatel zde má na výběr možnosti kdy osa roste buď nahoru (možnost "orient Y-axis upwards") a možnosti kdy osa klesá směrem dolů (možnost "orient Y-axis downwards").\\

Tlačítko s názvem "copy snapshot of the plot" zachycuje aktuální vizualizaci a ukládá snímek do schránky. Podobnou funkci zastává tlačítko "save curve/image/plot snapshot dialog" která uloží aktuální graf, obraz, nebo konkrétní křivku do souboru. Aplikace disponuje i tlačítkem pro tisk které při aktivaci umožní vytisknout aktuální graf a otevírá běžného správce tisku pro daný operační systém. Pro účely analýzy je zde i tlačítko "enable horizontal line profile selection", které umožňuje výběr horizontálního profilu dat. Nakonec je zde tlačítko "clear profiles", které vymaže všechny aktuálně zobrazené profily

Další důležitou funkcí nástrojové lišty je možnost zobrazení nebo skrytí jednotlivých ROI. To umožňuje provádět srovnávací analýzu mezi různými částmi snímku a identifikovat klíčové rozdíly. Pokud uživatel potřebuje pracovat pouze s vybranými ROI, může jednoduše skrýt ostatní oblasti, čímž se usnadní jejich vyhodnocení.\\

Systém je navržen tak, aby podporoval víceúrovňovou práci s ROI, čili že uživatel může zároveň spravovat několik ROI a analyzovat jejich vzájemné vztahy. Všechny akce v rámci ovládacího panelu jsou synchronizovány s vizualizačním modulem, uživatel má tedy neustálý přehled o tom, jaké oblasti jsou aktivní a jaké parametry jsou vyhodnocovány.\\

Díky kombinaci interaktivního výběru ROI, pokročilé správy v ovládacím panelu a propojení se statistickým modulem poskytuje aplikace efektivní nástroje pro analýzu difrakčních snímků. Tímto způsobem je možné přesně vyhodnotit rozložení intenzity signálu a získat důležité informace o struktuře analyzovaných vzorků.\\

\subsection{ROI}
 ROI (Region of interest) nebo také oblast zájmu slouží k vyhodnocování intenzity signálu v konkrétních částech snímku, tím umožňuje izolovat klíčové detaily pro další zpracování. ROI jsou základním nástrojem pro kvantitativní analýzu. Každá oblast je spravována ROI managerem, který se nachází v pravé části GUI jako dokovací okno. Ten zajišťuje jejich evidenci a propojení s analytickými funkcemi. Po přidání je ROI automaticky registrována do systému a propojena s nástrojem ROI Stats Widget, který umožňuje výpočet, vizualizaci statistik souvisejících s danou oblastí a ukazuje label (název), kind (typ), coordinates (souřadnice) a zároveň umožňuje ROI editovat nebo odstranit.\\

Proces přidávání ROI je umožněn prostřednictvím interaktivního uživatelského rozhraní obsaženého v ROI manageru. Uživatel má možnost manuálně definovat oblast na snímku pomocí myši a následně ji přizpůsobit podle požadavků analýzy. Po výběru ROI se její data okamžitě zapisují do interního systému aplikace. Každá ROI může být individuálně konfigurována, nebo-li uživatel může upravit její velikost, tvar a přesnou polohu ve snímku.\\

Aplikace podporuje různé tvary, mezi které patří předdefinované obdélníkové, eliptické nebo volně definované uživatelem, což poskytuje vysokou flexibilitu při analýze. Každá přidaná oblast je evidována ve správci ROI, kde je možné ji přejmenovat, duplikovat, nebo odstranit, čímž se usnadňuje organizace a porovnávání různých částí snímku.\\

Díky automatickému režimu aktualizace je jakákoli změna ROI okamžitě reflektována ve výpočtech a vizualizaci dat. Pokud uživatel preferuje manuální režim, je možné aktualizaci řídit pomocí ručně spouštěných výpočtů pro lepší kontrolu nad vyhodnocením výsledků. Všechny změny ROI jsou uchovávány po dobu analýzy a lze je dynamicky měnit podle potřeby.



\section{Závěr}

\section{Zdroje}

\end{document}
